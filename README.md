### 2.1 Сети: Протоколы сетевого уровня - IP, ICMP

#### IP

*   **Что такое IP адрес? Как выглядит? Зачем нужен?**

    IP-адрес — это уникальный идентификатор устройства (хоста) в сети. Это как почтовый адрес для компьютера. Выглядит IP-адрес IPv4 как четыре числа от 0 до 255, разделенные точками (например, 192.168.1.1). IP-адреса IPv6 состоят из восьми групп шестнадцатеричных чисел, разделенных двоеточиями (например, 2001:0db8:85a3:0000:0000:8a2e:0370:7334). IP-адрес необходим, чтобы устройства могли находить друг друга в сети и обмениваться данными.

*   **Что такое хост?**

    Хост — это любое устройство, подключенное к сети, имеющее свой IP-адрес и способное отправлять и получать данные. Это может быть компьютер, смартфон, сервер, принтер, или любое другое устройство с сетевым интерфейсом.

*   **В чем разница между IPv4 и IPv6?**

    *   **IPv4:** Использует 32-битный адрес, что позволяет адресовать около 4,3 миллиарда устройств. Из-за растущего числа устройств в интернете IPv4 адресов стало не хватать.
    *   **IPv6:** Использует 128-битный адрес, что позволяет адресовать практически неограниченное количество устройств. IPv6 также имеет другие преимущества, такие как улучшенная безопасность и упрощенная конфигурация.

*   **Что такое белый и серый IP-адреса?**

    *   **Белый (публичный) IP-адрес:** Уникальный IP-адрес, который виден в интернете. Он используется для прямого соединения с устройством из любой точки мира.
    *   **Серый (частный) IP-адрес:** IP-адрес, используемый во внутренней сети (например, дома или в офисе). Устройства с серыми IP-адресами подключаются к интернету через маршрутизатор (NAT), который имеет белый IP-адрес. Это как несколько квартир в одном доме, которые используют один общий почтовый адрес.

*   **Что такое маска? Какие задачи решает?**

    Маска — это 32-битное число, которое используется для определения сети и хоста в IP-адресе. Маска указывает, какая часть IP-адреса относится к адресу сети, а какая — к адресу хоста в этой сети. Это как указать, какие цифры в адресе дома относятся к названию улицы, а какие - к номеру дома. Маска позволяет маршрутизаторам определять, находится ли целевой хост в той же сети, что и отправитель, или нужно отправить пакет в другую сеть.

*   **Что такое шлюз в контексте протокола IP?**

    Шлюз — это устройство (обычно маршрутизатор), которое соединяет одну сеть с другой. Когда хост хочет отправить пакет в сеть, отличную от его собственной, он отправляет пакет на шлюз. Шлюз перенаправляет пакет в правильную сеть. Это как почтовый ящик, в который мы бросаем письма, чтобы они были доставлены по нужному адресу.

*   **Как рассчитать подсеть?**

    Расчет подсети — это процесс разделения большой сети на несколько меньших подсетей. Это делается путем изменения маски сети. Например, можно разделить сеть класса C (255.255.255.0) на несколько подсетей, увеличив маску (например, 255.255.255.128). Расчет подсетей позволяет более эффективно использовать IP-адреса и улучшить безопасность сети.

*   **Как пакеты проходят по сети в контексте модели TCP/IP? Почему так много уровней? Какую роль каждый уровень играет при передаче от одного хоста другому?**

    Модель TCP/IP описывает, как данные передаются по сети, разбивая процесс на несколько уровней:
    1.  **Прикладной уровень:** Предоставляет сетевые сервисы приложениям (например, HTTP, SMTP, SSH).
    2.  **Транспортный уровень:** Обеспечивает надежную передачу данных между приложениями (TCP) или быструю, но ненадежную (UDP).
    3.  **Сетевой уровень:** Отвечает за маршрутизацию пакетов между сетями (IP).
    4.  **Канальный уровень:** Отвечает за передачу данных между устройствами в одной сети (Ethernet).
    5.  **Физический уровень:** Определяет физические характеристики среды передачи (например, кабель, радиоволны).

    Каждый уровень выполняет свою задачу, добавляя к данным свою "обертку" (заголовок). Когда пакет достигает целевого хоста, каждый уровень снимает свою "обертку", пока данные не достигнут приложения. Использование многоуровневой модели упрощает разработку и обслуживание сети, так как каждый уровень может быть изменен независимо от других.

#### ICMP

*   **Что такое ICMP протокол?**

    ICMP (Internet Control Message Protocol) — это протокол управления и отладки в сетях TCP/IP. Он используется для передачи сообщений об ошибках и другой служебной информации между устройствами в сети. ICMP работает на сетевом уровне (уровень IP).

*   **Какие задачи выполняет ICMP протокол?**

    ICMP выполняет следующие задачи:
    *   Сообщает об ошибках при передаче данных (например, "хост недоступен", "сеть недостижима").
    *   Позволяет проверить доступность хоста (ping).
    *   Позволяет определить маршрут прохождения пакетов (traceroute).
    *   Передает информацию о перегрузке сети.

*   **Почему в межсетевом экране часто закрывают протокол ICMP?**

    ICMP может быть использован злоумышленниками для получения информации о сети (например, для сканирования сети или для проведения DoS-атак). Поэтому в межсетевых экранах часто закрывают ICMP трафик, чтобы повысить безопасность сети.

*   **Что такое трассировка через traceroute? Зачем нужно?**

    Traceroute — это утилита, которая позволяет определить маршрут, по которому пакеты проходят от одного хоста к другому. Traceroute отправляет серию пакетов с постепенно увеличивающимся значением TTL (Time To Live) и анализирует ICMP-сообщения об ошибках, которые возвращаются от промежуточных маршрутизаторов. Трассировка нужна для диагностики проблем с сетью, например, для определения, на каком участке маршрута происходит задержка или потеря пакетов.

*   **Какой принцип работы трассировки?**

    Traceroute работает следующим образом:
    1.  Отправляет пакет с TTL = 1. Первый маршрутизатор в пути уменьшает TTL до 0 и отправляет ICMP-сообщение "TTL exceeded" отправителю.
    2.  Отправляет пакет с TTL = 2. Второй маршрутизатор отправляет ICMP-сообщение "TTL exceeded".
    3.  Процесс повторяется, пока пакет не достигнет целевого хоста.
    4.  Целевой хост отправляет ICMP-сообщение "Port unreachable" (или другой ICMP-ответ), что означает, что трассировка завершена.

*   **Почему при трассировке через traceroute часто многие промежуточные хосты в интернете подсвечиваются как "* * * * *"?**

    Это происходит потому, что некоторые маршрутизаторы в интернете настроены на то, чтобы не отвечать на ICMP-сообщения "TTL exceeded" из соображений безопасности или производительности.

*   **Зачем нужна команда ping?**

    Команда `ping` отправляет ICMP-запрос "Echo Request" на указанный хост и ждет ответа "Echo Reply". Это позволяет проверить доступность хоста и измерить время задержки (round-trip time, RTT).

*   **Что такое TTL в контексте ping?**

    TTL (Time To Live) — это максимальное количество хопов (маршрутизаторов), которое может пройти пакет, прежде чем он будет отброшен. TTL используется для предотвращения бесконечной циркуляции пакетов в сети. При каждом прохождении пакета через маршрутизатор TTL уменьшается на 1. Если TTL достигает 0, маршрутизатор отбрасывает пакет и отправляет ICMP-сообщение "TTL exceeded" отправителю. В контексте `ping` TTL позволяет ограничить область поиска хоста.

### 2.3 Сети: Протоколы прикладного уровня - SSH

#### SSH

*   **Что такое SSH, на каком порте работает?**

    SSH (Secure Shell) — это сетевой протокол, который позволяет устанавливать безопасное соединение с удаленным компьютером. SSH шифрует все данные, передаваемые между клиентом и сервером, что защищает от прослушивания и перехвата. SSH работает по умолчанию на порту 22.

*   **Как подключиться к хосту по ssh? Через публичный и приватный ключи?**

    Подключиться к хосту по SSH можно с помощью команды:

    ```bash
    ssh <пользователь>@<IP-адрес>
    ```

    Для подключения через публичный и приватный ключи необходимо:
    1.  Сгенерировать пару ключей на локальном компьютере:

        ```bash
        ssh-keygen
        ```

    2.  Скопировать публичный ключ на удаленный хост:

        ```bash
        ssh-copy-id <пользователь>@<IP-адрес>
        ```

    После этого можно будет подключаться к хосту без ввода пароля.

*   **В каком файле находится публичный ключ на удалённом хосте?**

    Публичные ключи пользователей хранятся в файле `~/.ssh/authorized_keys` в домашнем каталоге пользователя на удаленном хосте.

*   **Как настроить ssh-config? Зачем он нужен?**

    Файл `~/.ssh/config` позволяет задать настройки для SSH-соединений, чтобы не нужно было каждый раз указывать параметры подключения в командной строке. Например, можно задать имя пользователя, IP-адрес, порт и ключ для подключения к конкретному хосту.
    Например:

    ```
    Host myhost
      HostName 192.168.1.100
      User myuser
      IdentityFile ~/.ssh/mykey
    ```

    После этого можно будет подключаться к хосту с помощью команды `ssh myhost`.

*   **Что такое jump host? Зачем используется? Как настроить?**

    Jump host (или bastion host) — это промежуточный сервер, который используется для доступа к другим серверам во внутренней сети, которые не имеют прямого доступа к интернету. Jump host используется для повышения безопасности, так как позволяет ограничить доступ к внутренним серверам только через один защищенный хост.
    Для настройки jump host нужно:
    1.  Настроить SSH-соединение с jump host.
    2.  Использовать опцию `-J` при подключении к целевому серверу:

        ```bash
        ssh -J <пользователь_jump_host>@<IP_jump_host> <пользователь_целевого_сервера>@<IP_целевого_сервера>
        ```

    Или можно настроить все в `~/.ssh/config`:

    ```
    Host target_host
      HostName <IP_целевого_сервера>
      User <пользователь_целевого_сервера>
      ProxyJump <пользователь_jump_host>@<IP_jump_host>
    ```

*   **Как передавать файлы по ssh? Как сделать это рекурсивно?**

    Для передачи файлов по SSH используется команда `scp` (Secure Copy):

    ```bash
    scp <файл> <пользователь>@<IP-адрес>:<путь_назначения>
    ```

    Для передачи каталога рекурсивно используется опция `-r`:

    ```bash
    scp -r <каталог> <пользователь>@<IP-адрес>:<путь_назначения>
    ```

*   **Что такое zsh и как настроить ssh autocompletion?**

    Zsh — это альтернативная командная оболочка для Linux, которая имеет множество полезных функций, включая автодополнение. Чтобы настроить автодополнение для SSH в Zsh, нужно установить пакет `zsh-autocomplete` и добавить следующие строки в файл `~/.zshrc`:

    ```bash
    autoload -U +X compinit && compinit
    autoload -U +X bashcompinit && bashcompinit
    complete -o default -o bashdefault -W "$(cat ~/.ssh/known_hosts | cut -d' ' -f1 | sed 's/,.*//')" scp ssh sftp
    ```
    После этого нужно перезапустить терминал или выполнить команду `source ~/.zshrc`.
