## Сети в Linux: ICMP и SSH

**Цель:** Освоить основы работы с протоколами ICMP и SSH в Linux, включая их назначение, структуру, инструменты отладки, настройку безопасности и передачу файлов.

**1. ICMP (Internet Control Message Protocol):**

*   **Что делать:** Понять назначение протокола ICMP, структуру его заголовков и научиться использовать инструменты отладки.

*   **Зачем нужен ICMP:**
    *   Использовать для диагностики сети.
    *   Передавать сообщения об ошибках и служебную информацию.
    *   Поддерживать работу протокола IP.

*   **Заголовки ICMP (IPv4):**
    *   **Type (8 бит):** Тип сообщения (например, 0 - Echo Reply, 3 - Destination Unreachable, 8 - Echo Request).
    *   **Code (8 бит):** Код, уточняющий тип сообщения (например, для Destination Unreachable указывает причину недостижимости).
    *   **Checksum (16 бит):** Контрольная сумма для проверки целостности ICMP-сообщения.
    *   **Data (переменная длина):** Зависит от типа сообщения. Для Echo Request/Reply содержит идентификатор и номер последовательности.

*   **Инструменты отладки ICMP:**
    *   **`ping <хост>`:** Отправить ICMP Echo Request и проверить доступность хоста.
        *   `-c <количество>`: Отправить указанное количество запросов.
        *   `-i <интервал>`: Задать интервал между запросами.
        *   `-t <TTL>`: Установить значение Time To Live (TTL).
    *   **`traceroute <хост>`:** Определить маршрут до хоста, отправляя ICMP Time Exceeded сообщения.
        *   `-I`: Использовать ICMP Echo Request вместо UDP (traceroute по умолчанию использует UDP).
    *   **`tcpdump -n -i <интерфейс> icmp`:** Захватить и проанализировать ICMP-трафик на указанном интерфейсе.
        *   `-n`: Не преобразовывать адреса и порты в имена.
        *   `-i <интерфейс>`: Указать сетевой интерфейс для захвата трафика.

**2. SSH (Secure Shell):**

*   **Что делать:** Узнать, что такое SSH, на каком порте он работает, как подключаться к хостам, настраивать конфигурацию и обеспечивать безопасность.

*   **Что такое SSH:**
    *   Протокол для безопасного удаленного доступа к компьютеру.
    *   Шифрует весь трафик между клиентом и сервером.
    *   Использует для удаленного управления, передачи файлов и туннелирования трафика.

*   **Порт SSH:**
    *   По умолчанию работает на порту **22**.
    *   Рекомендуется изменить порт SSH для повышения безопасности.

*   **Как подключиться к хосту по SSH:**
    *   `ssh <пользователь>@<хост>`: Подключиться к хосту, указав имя пользователя и адрес хоста.
    *   `ssh -p <порт> <пользователь>@<хост>`: Подключиться к хосту, указав нестандартный порт.
    *   `ssh -i <ключ> <пользователь>@<хост>`: Подключиться к хосту, используя приватный ключ.

*   **Настройка `ssh_config` (клиентская конфигурация):**
    *   Файл `~/.ssh/config` позволяет задавать параметры подключения для разных хостов.
    *   Преимущества:
        *   Не нужно каждый раз вводить имя пользователя, порт и другие параметры.
        *   Упрощает подключение к часто используемым хостам.
    *   Пример конфигурации:

        ```
        Host my-server
            HostName example.com
            User myuser
            Port 2222
            IdentityFile ~/.ssh/id_rsa
        ```

        Теперь можно подключаться к серверу просто командой `ssh my-server`.

*   **Jump Host (ProxyJump):**
    *   Использовать для подключения к хосту, который находится за файрволом или не имеет прямого доступа извне.
    *   SSH-клиент сначала подключается к Jump Host, а затем Jump Host устанавливает соединение с целевым хостом.
    *   Пример конфигурации в `~/.ssh/config`:

        ```
        Host target-server
            HostName target.internal
            User myuser
            ProxyJump jump-host

        Host jump-host
            HostName jump.example.com
            User jumpuser
        ```

        Теперь можно подключаться к целевому серверу командой `ssh target-server`.

*   **Настройки безопасности для SSH-сервера (`/etc/ssh/sshd_config`):**
    *   **`Port <номер порта>`:** Изменить порт SSH (по умолчанию 22).
    *   **`PermitRootLogin no`:** Запретить вход под пользователем root.
    *   **`AllowUsers <список пользователей>`:** Разрешить вход только указанным пользователям.
    *   **`PasswordAuthentication no`:** Запретить аутентификацию по паролю (рекомендуется использовать аутентификацию по ключам).
    *   **`PubkeyAuthentication yes`:** Разрешить аутентификацию по ключам.
    *   **`PermitEmptyPasswords no`:** Запретить вход с пустыми паролями.
    *   **`MaxAuthTries <количество попыток>`:** Ограничить количество попыток аутентификации.
    *   **`ClientAliveInterval <секунды>` и `ClientAliveCountMax <количество попыток>`:** Отключать неактивные соединения.
    *   **`UseDNS no`:** Отключить обратный DNS-lookup для ускорения подключения.

        После изменения `/etc/ssh/sshd_config` нужно перезапустить SSH-сервер: `sudo systemctl restart sshd`.

*   **Передача файлов по SSH:**
    *   **`scp <файл> <пользователь>@<хост>:<путь>`:** Скопировать файл на удаленный хост.
        *   `-r`: Скопировать каталог рекурсивно.
        *   `-P <порт>`: Указать нестандартный порт.
    *   **`scp <пользователь>@<хост>:<файл> <путь>`:** Скопировать файл с удаленного хоста.
    *   **`sftp <пользователь>@<хост>`:** Интерактивная сессия SFTP (Secure FTP) для управления файлами на удаленном хосте.
    *   **`rsync -avz <источник> <пользователь>@<хост>:<путь>`:** Синхронизировать файлы и каталоги с удаленным хостом (более эффективен, чем scp, особенно для больших файлов).

**В результате:** Студент должен понимать назначение протоколов ICMP и SSH, уметь использовать их для диагностики сети, удаленного доступа и передачи файлов, а также настраивать SSH для обеспечения безопасности.
