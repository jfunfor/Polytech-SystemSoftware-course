# Тема Основы мониторинга. Задание 1. Перегрузка вычислительного кластера.

В мегаполисе Найт-Сити на серверах корпорации **NeuroNet** работает центральный ИИ, обеспечивающий контроль над городскими системами. Последние 24 часа в работе города наблюдаются сбои: неоновые вывески мигают хаотично, уличные дроны сбиваются с маршрута, а сети перегружены. ИИ подозревается в запуске процесса, перегружающего вычислительные мощности. Вы — инженер-оператор мониторинга, которого вызвали провести первичную диагностику одной из Linux-нод, чтобы понять, в чём дело.

# Условие задания

1. Запустить скрипт `stress_test.sh`. Скрипт создает искусственную нагрузку и запускает специфичные процессы.
2. Cобрать метрики по трём категориям: CPU, RAM, диск.
3. Сохранить ключевые метрики в текстовые лог-файлы:
	- `cpu.log` — загрузка CPU по ядрам, процессы с наибольшей загрузкой; 
	- `ram.log` — объём используемой и свободной памяти, процессы с высоким потреблением памяти;
	- `disk.log` — свободное и используемое пространство по файловым системам, медленные/загруженные диски.
4. Анализировать и фильтровать вывод `dmesg`:
	- Вывести все строки, содержащие слова: `error`, `fail`, `warning`, `oom`;
	- Сохранить в файл `dmesg_filtered.log`.
5. Собрать информацию о сетевой активности:
	- Определить активные подключения и объём трафика;
	- Сохранить данные в `network.log`.
6. Сформировать итоговый отчёт `report.md`. Кратко описать:
	- Основные проблемы, выявленные в логах;
	- Наиболее ресурсоёмкие процессы;
	- Признаки перегрузки или ошибок.

**Внимание:** для итогового отчёта **обязательно** использовать шаблон, приведённый ниже.

```
# Отчёт по диагностике системы

## CPU
- Процесс `ххх` загружает __ ядра
- Средняя загрузка CPU: __ %

## RAM
- Процессы `ххх` используют около __ ГБ

## Диск
- Идёт активная запись `ххх`, занятие места __ ГБ

## Сеть
- Активные подключения к порту __ (процесс `ххх`)
- Исходящий ICMP-трафик от `ххх`

## dmesg
- Нет критических ошибок (в норме)
```

## Cоветы

Для проведения мониторинга рекомендуется использовать утилиты:
- CPU: `top`, `htop`, `pidstat`, `vmstat`;
- RAM: `free`, `vmstat`, `smem`;
- Диск: `df`, `du`, `iostat`;
- Сеть: `ss`, `netstat`, `iftop`, `nload`, `ip`.

Рекомендуется реализовать сбор данных в виде одного скрипта.

## Цели по теме Основы мониторинга

| Тема                                   | Применение                                                       |
| -------------------------------------- | ---------------------------------------------------------------- |
| Мониторинг CPU, утилиты                | Сбор метрик использования CPU                                    |
| Мониторинг RAM, утилиты                | Сбор метрик использования RAM                                    |
| Мониторинг диска, утилиты              | Cбор метрик использования диска                                  |
| dmesg                                  | Вывод диагностических сообщений, фильтрация сообщений об ошибках |
| Мониторинг сетевой активности, утилиты | Сбор метрик сетевой активности                                   |

## Автоматическая проверка 

Обратите внимание на то, что будет проверяться автоматически:

1. Наличие всех лог-файлов и отчета.
2. Наличие ключевых процессов в лог-файлах.
3. Содержание отчета `report.md`.

## TODO: разместить скрипт стресс-теста отдельно

```
#!/bin/bash

# Требуется prctl

# CPU нагрузка: запустить 4 процесса, каждый грузит 1 ядро
for i in {1..4}; do
  bash -c 'while :; do :; done' &
  renice -n 10 -p $! >/dev/null
  prctl --name cyber_cpu_burner --pid $!
done

# RAM нагрузка: выделить 1 ГБ на процесс
for i in {1..2}; do
  python3 -c 'a = ["X" * 1024 * 1024] * 1024' &
  prctl --name cyber_ram_eater --pid $!
done

# Диск нагрузка: активная запись в файл
dd if=/dev/zero of=disk_test_file bs=1M count=1024 oflag=direct &> /dev/null &
prctl --name cyber_disk_writer --pid $!

# Сетевая нагрузка: простой сервер + пинг
nc -l -p 8888 >/dev/null &
prctl --name cyber_net_listener --pid $!
ping -i 0.2 8.8.8.8 > /dev/null &
prctl --name cyber_net_spammer --pid $!

echo "Нагрузка запущена. Чтобы остановить: killall dd ping nc python3 bash"
```

