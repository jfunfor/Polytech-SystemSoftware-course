# –¢–µ–º–∞ –ú–µ–∂—Å–µ—Ç–µ–≤–æ–π —ç–∫—Ä–∞–Ω. –ó–∞–¥–∞–Ω–∏–µ 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–µ—Ä–≤–æ–ª–∞. 

–í—ã ‚Äî —Å–∏—Å–∞–¥–º–∏–Ω –ø–æ–≤—Å—Ç–∞–Ω—á–µ—Å–∫–æ–≥–æ —É–∑–ª–∞ —Å–≤—è–∑–∏, —Å–ø—Ä—è—Ç–∞–Ω–Ω–æ–≥–æ –≤ —Ç—Ä—É—â–æ–±–∞—Ö –ù–∞–π—Ç-–°–∏—Ç–∏. –ö–æ—Ä–ø–æ—Ä–∞—Ü–∏—è **Arasaka** –Ω–µ–¥–∞–≤–Ω–æ –Ω–∞—á–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–Ω–µ—Ç –Ω–∞ ICMP-–æ—Å–Ω–æ–≤–µ –¥–ª—è —Å–ª–µ–∂–∫–∏ –∏ –∞—Ç–∞–∫, –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —á–µ–≥–æ —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫ –≤–∞–º –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ª–µ–∑–µ—Ç –º—É—Å–æ—Ä.  

–£ –≤–∞—Å –µ—Å—Ç—å —à–ª—é–∑-–¥–∏—Å–ø–µ—Ç—á–µ—Ä (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `firewall`), —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç –¥—Ä–æ–Ω—ã (`drone`) –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã (`attacker`).

–í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å **–º–µ–∂—Å–µ—Ç–µ–≤–æ–π —ç–∫—Ä–∞–Ω (iptables)** –∏ **NAT**, —á—Ç–æ–±—ã:
1. –ù–∞–¥—ë–∂–Ω–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫.
2. –†–∞–∑—Ä–µ—à–∞—Ç—å –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–º —Å–æ—é–∑–Ω–∏–∫–∞–º.
3. –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã—Ö–æ–¥–∞ –¥—Ä–æ–Ω–æ–≤ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.

## –£—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞–Ω–∏—è

**–ß—Ç–æ –µ—Å—Ç—å**

- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `firewall` —Å –¥–≤—É–º—è —Å–µ—Ç–µ–≤—ã–º–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏:
    - `public_net` ‚Äî –≤–Ω–µ—à–Ω—è—è —Å–µ—Ç—å "–∏–Ω—Ç–µ—Ä–Ω–µ—Ç" (10.10.10.0/24);
    - `private_net` ‚Äî —Å–µ—Ç—å –¥—Ä–æ–Ω–æ–≤ (192.168.99.0/24);
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `attacker` –≤ `public_net` ‚Äî —ç–º—É–ª–∏—Ä—É–µ—Ç –≤–Ω–µ—à–Ω—é—é —É–≥—Ä–æ–∑—É.
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `drone` –≤ `private_net` ‚Äî –¥—Ä–æ–Ω-–ø–æ–ª—É—á–∞—Ç–µ–ª—å.

**–ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è**

–ù–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ `firewall`:
1. **–ó–∞–ø—Ä–µ—Ç–∏—Ç—å –≤–µ—Å—å ICMP** –Ω–∞ `public_net` (–ø–∏–Ω–≥ –∏ –ø—Ä–æ—á–µ–µ).
2. **–ó–∞–ø—Ä–µ—Ç–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ SSH (–ø–æ—Ä—Ç 22)** —Ç–æ–ª—å–∫–æ –¥–ª—è IP `10.10.10.2` (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `attacker`).
3. **–†–∞–∑—Ä–µ—à–∏—Ç—å** –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –ø–æ—Ä—Ç–∞–º —Ç–æ–ª—å–∫–æ –∏–∑ –ø–æ–¥—Å–µ—Ç–∏ `10.66.66.0/24`.
4. –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî **–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**.
5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å **SNAT (MASQUERADE)** –¥–ª—è –≤—ã—Ö–æ–¥–∞ –¥—Ä–æ–Ω–æ–≤ –≤ `public_net`.
6. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å **DNAT**: –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –≤—Ö–æ–¥—è—â–∏–µ –Ω–∞ `10.10.10.1:2222` ‚Üí `192.168.99.10:22`.

## –°–æ–≤–µ—Ç—ã

üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–¥–∞–Ω–∏—è –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
```
firewall-mission/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ check_firewall.sh
```

üì¶ `docker-compose.yml`:
```
version: '3.9'

networks:
  public_net:
    driver: bridge
    ipam:
      config:
        - subnet: 10.10.10.0/24
  private_net:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.99.0/24

services:
  firewall:
    build: .
    container_name: firewall
    privileged: true
    networks:
      public_net:
        ipv4_address: 10.10.10.1
      private_net:
        ipv4_address: 192.168.99.1
    volumes:
      - ./check_firewall.sh:/check_firewall.sh
    command: sleep infinity

  attacker:
    image: debian:bookworm
    container_name: attacker
    networks:
      public_net:
        ipv4_address: 10.10.10.2
    command: sleep infinity

  drone:
    image: debian:bookworm
    container_name: drone
    networks:
      private_net:
        ipv4_address: 192.168.99.10
    command: sleep infinity
```

üê≥ `Dockerfile`:
```
FROM debian:bookworm

RUN apt-get update && \
    apt-get install -y iproute2 iptables iputils-ping net-tools curl openssh-server && \
    apt-get clean

RUN echo "root:root" | chpasswd
RUN mkdir /var/run/sshd

CMD ["/usr/sbin/sshd", "-D"]
```

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ
```
docker-compose up --build -d
```

–ü–æ—Å–ª–µ —á–µ–≥–æ –∑–∞–π–¥–∏—Ç–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `firewall` –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –º–µ–∂—Å–µ—Ç–µ–≤–æ–π —ç–∫—Ä–∞–Ω —Å–æ–≥–ª–∞—Å–Ω–æ —É—Å–ª–æ–≤–∏—é –∑–∞–¥–∞–Ω–∏—è:
```
docker exec -it firewall bash
```

–ü–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:
```
docker exec -it firewall bash /check_firewall.sh
```

## –¶–µ–ª–∏ –ø–æ —Ç–µ–º–µ –ú–µ–∂—Å–µ—Ç–µ–≤–æ–π —ç–∫—Ä–∞–Ω

| –¢–µ–º–∞                                        | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ                                                              |
| ------------------------------------------- | ----------------------------------------------------------------------- |
| iptables, –æ—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏, –º–µ—Ç–æ–¥—ã, –ø—Ä–∞–≤–∏–ª–∞ | –ò–∑—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏ —Ä–∞–±–æ—Ç—ã —Å iptables –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–≤–æ–µ–≥–æ —Ñ–∞–µ—Ä–≤–æ–ª–∞       |
| –ó–∞–ø—Ä–µ—Ç ICMP –ø—Ä–æ—Ç–æ–∫–æ–ª–∞, –ø–æ—Ä—Ç–æ–≤               | –ó–∞–ø—Ä–µ—Ç ICMP –¥–ª—è –≤–Ω–µ—à–Ω–µ–π —Å–µ—Ç–∏, –∑–∞–ø—Ä–µ—Ç –ø–æ—Ä—Ç–∞ 22 –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ IP-–∞–¥—Ä–µ—Å–∞ |
| –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NAT                               | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNAT —Å–æ–≥–ª–∞—Å–Ω–æ —É—Å–ª–æ–≤–∏—é –∑–∞–¥–∞–Ω–∏—è                                 |

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –±–µ–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –ø—É–Ω–∫—Ç–∞ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è".