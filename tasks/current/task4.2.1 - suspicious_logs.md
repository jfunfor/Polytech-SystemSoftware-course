# Тема Логирование. Задание 1. Подозрительные логи.

Вы — инженер в корпорации _CyberWatch_, ответственной за кибербезопасность корпоративной инфраструктуры. Один из серверов подвергся кибератаке, и вам нужно выяснить, что произошло, защитить систему от повторной атаки и подготовить инфраструктуру для централизованного мониторинга логов в реальном времени.

## Условие задания

Вы получили следующее техническое задание:

> В логах сервера замечена подозрительная активность: неизвестный процесс каждый вечер в 23:59 перезапускает системный сервис `cyberwatch.service`, и в момент рестарта наблюдается аномальное увеличение трафика. Ваша задача — зафиксировать эту активность с помощью `journalctl`, затем настроить систему так, чтобы логи:
> - Автоматически ротировались и хранились максимум 7 дней;
> - Передавались на сервер 10.0.0.2 через rsyslog;
> - Могли быть просмотрены в случае повторной атаки.

**Пояснения к ТЗ:**
1. Найдите все перезапуски `cyberwatch.service` за последние 3 дня и сохраните их в файл `/var/log/cyberwatch_incidents.log`.
2. Настройте ротацию логов:
	- Настроить `logrotate` для `/var/log/cyberwatch_incidents.log`;
	- Условия: ротация раз в день, хранить максимум 7 ротаций, сжатие `gzip`.
3. Настройте `rsyslog`. Убедитесь, что логи `/var/log/cyberwatch_incidents.log` дублируются на удалённый сервер по адресу `10.0.0.2`, порт 514 UDP.
4. Перезапустите необходимые сервисы и убедитесь, что всё работает.

## Советы

Для анализа логов за последние 3 дня используйте:
```
journalctl -u cyberwatch.service --since "3 days ago"
```

Для `logrotate` не забудьте создать файл в `/etc/logrotate.d/`.

Для настройки `rsyslog` в `rsyslog.conf` необходимо прописать правило:
```
*.*  @10.0.0.2:514
```

## Цели по теме Логирование

| Тема                        | Применение                            |
| --------------------------- | ------------------------------------- |
| Работа с journalctl         | Получение логов о перезапуске сервиса |
| Ротация логов               | Настройка ротации логов согласно ТЗ   |
| Централизованный сбор логов | Cбор логов с помощью rsyslog          |

## Автоматическая проверка 

Обратите внимание на то, что будет проверяться автоматически:

1. Наличие файла-журнала логов.
2. Содержимое этого файла.
3. Конфигурация logrotate.
4. Наличие сжатых логов.
5. Настройка rsyslog.

## TODO: разместить отдельно

Сервис `/etc/systemd/system/cyberwatch.service`:
```
[Unit]
Description=Cyberwatch monitoring agent
After=network.target

[Service]
ExecStart=/usr/local/bin/cyberwatch.sh
Restart=always
RestartSec=60
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

Скрипт `/usr/local/bin/cyberwatch.sh`:
```
#!/bin/bash

echo "[`date`] Cyberwatch alert: unusual network activity detected from 10.0.99.13" 

# Симулируем работу: логируем в системный журнал и немного ждём
sleep 10
```

