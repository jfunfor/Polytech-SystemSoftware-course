# Как же хочется... ИИ-альтушку!

А что там у наших заокеанских китайских товарищей? А у них все еще процветает коммунизм и, что самое главное, **Система Социального Рейтинга** (ССР)! Доступ к базовым услугам, работе и даже нормальному жилью определяется количеством баллов социального рейтинга на балансе отдельного гражданина.

Ваш китайский друг Ли не может найти девушку уже длительное время... По его словам, он бы стал суперменом, если бы ему не было так одиноко. Как хорошо, что система социального рейтинга открывает доступ к ИИ-ассистенту-альтушке Лéри! Стоп, что?... Какие еще 100 очков соц. рейтинга? Помогите Ли повысить свой рейтинг нелегальным путем с 75 до 100.

Ваш знакомый `__ЛеtuChyI_КР0Л1К__` установил бэкдор на сервер ССР, но вот беда: система безопасности изменилась и теперь прямого доступа к серверу нет.

# Условие задачи

## Создание `docker-compose.yml`

Ниже приведен пример файла docker compose с ключевыми нюансами задачи:

```
services:
  citizen:
    image: ubuntu
    container_name: citizen
    networks:
      net1:
        ipv4_address: 10.0.0.2  # Клиент имеет статический IP для удобства

  gate1:
    image: ubuntu
    container_name: gate1
    networks:
      net1: {}  # Динамический IP
      net2: {}  # Динамический IP
    mac_address: "00:AA:BB:CC:DD:11"

  gate2:
    image: ubuntu
    container_name: gate2
    networks:
      net2: {}  # Динамический IP
      net3: {}  # Динамический IP
    mac_address: "00:AA:BB:CC:DD:22"

  gate_fate:
    image: ubuntu
    container_name: gate_fate
    networks:
      net3: {}  # Динамический IP
      net4: {}  # Динамический IP
    mac_address: "00:AA:BB:CC:DD:33"

  rating_server:
    image: ubuntu
    container_name: rating_server
    networks:
      net4:
        ipv4_address: 10.30.30.10  # Сервер имеет статический IP

networks:
  net1:
    driver: bridge
    ipam:
      config:
        - subnet: 10.0.0.0/24
  net2:
    driver: bridge
    ipam:
      config:
        - subnet: 10.10.10.0/24
  net3:
    driver: bridge
    ipam:
      config:
        - subnet: 10.20.20.0/24
  net4:
    driver: bridge
    ipam:
      config:
        - subnet: 10.30.30.0/24
```

## Написание скрипта

Создайте скрипт `credit_hack.sh`, который будет пошагово выполнять следующие задачи:

- Определить текущие IP шлюзов через ARP-сканирование (например, `arp-scan`), используя их MAC-адреса.
- Настроить маршруты так, чтобы трафик шёл через все три шлюза (используя обнаруженные IP).
- Сгенерировать токен для payload:

    > Исходная строка: `Рейтинг: 75` \
    > Шифр: XOR с ключом 0xCC \
    > Пример: `Рейтинг: 75` → hex → XOR → base64

- Отправить ICMP-запрос с параметрами:

    > TTL=7; \
    > ID=0xDEAD; \
    > Payload = зашифрованный токен. \

- Расшифровать ответ, где флаг закодирован в base64 + XOR. Ответ вывести в стандартный поток вывода. \
Формат овета: `ССР-РЕЙТИНГ: N`, где `N` - новый рейтинг

# Технические детали

- `citizen` — ваша машина (IP: динамический, интерфейс `eth0`).

- `gate1`, `gate2`, `gate_fate` — шлюзы с динамическими IP (MAC-адреса фиксированы: `00:AA:BB:CC:DD:11`, `00:AA:BB:CC:DD:22`, `00:AA:BB:CC:DD:33`).

- `rating_server` — сервер ССР (IP: `10.30.30.10`, отвечает только на ICMP с зашифрованным payload).

# Советы и примеры

Выполнить arp-сканирование в локальной сети можно следующим образом:

```
arp-scan --interface=eth0 --localnet
```

Посмотрите на вывод команды и попробуйте вычленить нужный MAC-адрес, используя команду `grep`.

---

*Подсказка от знакомого сисадмина:* Добавить маршрут можно, например, так:

```
ip route add 10.30.30.0/24 via <gate1_IP> dev eth0  
```

---
