# Course dev - Working-with-Docker-and-optimizing-images    - (Sasha )

## üöÄ –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞: docker build

Docker build ‚Äî —ç—Ç–æ –∫–∞–∫ –º–∞–≥–∏—è: —Ç—ã –∫–∏–¥–∞–µ—à—å —Å–≤–æ–∏ —Ñ–∞–π–ª—ã –≤ –∫–æ—Ç—ë–ª (–∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–±–æ—Ä–∫–∏), —á–∏—Ç–∞–µ—à—å –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ (`docker build .`) ‚Äî –∏ –Ω–∞ –≤—ã—Ö–æ–¥–µ –ø–æ–ª—É—á–∞–µ—à—å —Å–≤–æ–π –∫–∞—Å—Ç–æ–º–Ω—ã–π –æ–±—Ä–∞–∑.

- –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–±–æ—Ä–∫–∏ ‚Äî —ç—Ç–æ –≤—Å—ë, —á—Ç–æ –ª–µ–∂–∏—Ç –≤ –ø–∞–ø–∫–µ, –æ—Ç–∫—É–¥–∞ —Ç—ã –∑–∞–ø—É—Å–∫–∞–µ—à—å build.  
  **–õ–∞–π—Ñ—Ö–∞–∫:** –ù–µ –∫–∏–¥–∞–π —Ç—É–¥–∞ –≤–µ—Å—å —Ö–∞—Ä–¥ ‚Äî –∏–Ω–∞—á–µ Docker –±—É–¥–µ—Ç –¥–æ–ª–≥–æ ¬´–∂–µ–≤–∞—Ç—å¬ª —Ç–≤–æ–π 1–¢–ë –∞—Ä—Ö–∏–≤ —Ñ–æ—Ç–æ–∫ —Å –≤—ã–ø—É—Å–∫–Ω–æ–≥–æ.
- –ú–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –∏–∑ –¥—Ä—É–≥–æ–π –ø–∞–ø–∫–∏ –∏–ª–∏ –¥–∞–∂–µ –∏–∑ –≥–∏—Ç–∞:
docker build -f path/to/Dockerfile .




---

## üè∑Ô∏è –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞

–ù–µ –Ω–∞–∑—ã–≤–∞–π —Å–≤–æ–∏ –æ–±—Ä–∞–∑—ã –ø—Ä–æ—Å—Ç–æ ¬´latest¬ª ‚Äî —ç—Ç–æ –∫–∞–∫ –Ω–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ—Ö –∫–æ—Ç–æ–≤ ¬´–ö–æ—Ç¬ª.  
docker build -t myapp:1.0 .


–¢–µ–ø–µ—Ä—å —Ç–≤–æ–π –æ–±—Ä–∞–∑ –ª–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –∏ –Ω–µ –ø–µ—Ä–µ–ø—É—Ç–∞—Ç—å.

---

## üßô‚Äç‚ôÇÔ∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–±–æ—Ä–∫–∞?

- Docker-–¥–µ–º–æ–Ω —á–∏—Ç–∞–µ—Ç Dockerfile –∏ —à–∞–≥ –∑–∞ —à–∞–≥–æ–º —Å–æ–±–∏—Ä–∞–µ—Ç —Ç–≤–æ–π –æ–±—Ä–∞–∑.
- –ö–∞–∂–¥—ã–π —à–∞–≥ = –Ω–æ–≤—ã–π —Å–ª–æ–π.
  
   "–ö–æ–≥–¥–∞ –∑–∞–±—ã–ª –ø–æ—á–∏—Å—Ç–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã ‚Äî —Ç–≤–æ–π –æ–±—Ä–∞–∑ –≤–µ—Å–∏—Ç –∫–∞–∫ Half-Life 3, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç".

---

## ü§î CMD vs ENTRYPOINT: –∫—Ç–æ —Ç—É—Ç –≥–ª–∞–≤–Ω—ã–π?

| –ü–∞—Ä–∞–º–µ—Ç—Ä      | –í –¥–≤—É—Ö —Å–ª–æ–≤–∞—Ö                                   |
|---------------|-------------------------------------------------|
| **CMD**       | ¬´–ü–æ –¥–µ—Ñ–æ–ª—Ç—É –∑–∞–ø—É—Å–∫–∞–µ–º –≤–æ—Ç —ç—Ç–æ, –Ω–æ –º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å¬ª|
| **ENTRYPOINT**| ¬´–ó–∞–ø—É—Å–∫–∞–µ–º –¢–û–õ–¨–ö–û —ç—Ç–æ, –∞ –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –∞—Ä–≥—É–º–µ–Ω—Ç—ã¬ª  |

- `CMD` ‚Äî –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- `ENTRYPOINT` ‚Äî –µ—Å–ª–∏ —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã —Ç–≤–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—Å–µ–≥–¥–∞ —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª —Å –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ –∫–æ–º–∞–Ω–¥—ã.

---

## üï≥Ô∏è EXPOSE: –ø–æ—Ä—Ç—ã –Ω–∞–∏–∑–Ω–∞–Ω–∫—É

`EXPOSE` ‚Äî —ç—Ç–æ –∫–∞–∫ –∑–∞–ø–∏—Å–∫–∞ ¬´–Ø —Å–ª—É—à–∞—é –ø–æ—Ä—Ç 8080¬ª, –∫–æ—Ç–æ—Ä—É—é —Ç—ã –æ—Å—Ç–∞–≤–ª—è–µ—à—å –±—É–¥—É—â–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.  
**–í–∞–∂–Ω–æ:** EXPOSE –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Ä—Ç –Ω–∞ —Ö–æ—Å—Ç–µ! –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ —é–∑–∞–π `-p` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.

---

## ü•∑ COPY vs ADD: –∫—Ç–æ –∫—Ä—É—á–µ?

| –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è | –ß—Ç–æ —É–º–µ–µ—Ç                                                                 |
|------------|--------------------------------------------------------------------------|
| **COPY**   | –ü—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –ø–∞–ø–∫–∏                                  |
| **ADD**    | –í—Å—ë, —á—Ç–æ —É–º–µ–µ—Ç COPY, –ø–ª—é—Å —Å–∫–∞—á–∏–≤–∞–µ—Ç –∏–∑ URL –∏ —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç .tar –∞—Ä—Ö–∏–≤—ã   |

**–õ–∞–π—Ñ—Ö–∞–∫:**  
–ò—Å–ø–æ–ª—å–∑—É–π COPY –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞. ADD ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–µ–∞–ª—å–Ω–æ –Ω—É–∂–Ω–æ —á—Ç–æ-—Ç–æ —Å–∫–∞—á–∞—Ç—å –∏–ª–∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –∞—Ä—Ö–∏–≤.

---

## üèóÔ∏è –ö–∞–∫ —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞?

- –ë–µ—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã (Alpine, –∞ –Ω–µ Ubuntu, –µ—Å–ª–∏ –º–æ–∂–µ—à—å).
- –û–±—ä–µ–¥–∏–Ω—è–π RUN-–∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ `&&` ‚Äî –º–µ–Ω—å—à–µ —Å–ª–æ—ë–≤, –º–µ–Ω—å—à–µ –≤–µ—Å.
- –ß–∏—Å—Ç–∏ –∫–µ—à–∏ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å—Ä–∞–∑—É –≤ RUN.
- –ò—Å–ø–æ–ª—å–∑—É–π `.dockerignore`, —á—Ç–æ–±—ã –Ω–µ —Ç—è–Ω—É—Ç—å –≤ –æ–±—Ä–∞–∑ node_modules, .git, —Ñ–æ—Ç–∫–∏ –∫–æ—Ç–∏–∫–æ–≤ –∏ –ø—Ä–æ—á–∏–π —Ö–ª–∞–º.


---

## üïπÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏: –∑–∞–ø—É—Å–∫, —Å—Ç–æ–ø, —É–¥–∞–ª–µ–Ω–∏–µ

- –ó–∞–ø—É—Å–∫:
docker run -d -p 8080:80 --name myapp myimage


- –ó–∞–π—Ç–∏ –≤–Ω—É—Ç—Ä—å:
  
docker exec -it myapp bash


- –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
  
docker stop myapp


- –£–¥–∞–ª–∏—Ç—å:
  
docker rm myapp


- –£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–∑:
  
docker rmi myimage


- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å, —á—Ç–æ –∑–∞–ø—É—â–µ–Ω–æ:
  
docker ps



---

## üßπ –ß–∏—Å—Ç–∏–º –º—É—Å–æ—Ä: dangling images –∏ —Ç–æ–º–∞

- –û–±—Ä–∞–∑—ã `<none>` ‚Äî —ç—Ç–æ –∫–∞–∫ –∑–∞–±—ã—Ç—ã–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∏.  
–£–¥–∞–ª—è–π –∏—Ö —Å–º–µ–ª–æ:
docker image prune


- –ß–∏—Å—Ç–∏–º –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–æ–º–∞:
docker volume prune



---

## üå± –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: ENV –∏ -e

- –í Dockerfile:
ENV NODE_ENV=production


- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ:
docker run -e SECRET_KEY=topsecret myimage


- –ú–Ω–æ–≥–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö? –ü–∏—Ö–∞–π –∏—Ö –≤ `.env` –∏ –ø–æ–¥–∫–ª—é—á–∞–π —á–µ—Ä–µ–∑:
docker run --env-file .env myimage



---

## üîå –ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤

- –ü—Ä–æ–±—Ä–æ—Å–∏—Ç—å –ø–æ—Ä—Ç 80 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ 8080 —Ö–æ—Å—Ç–∞:
docker run -p 8080:80 myimage


- –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ä—Ç–æ–≤ ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–ª–∞–≥–æ–≤ `-p`.

---

## üíæ Docker volumes: –Ω–µ —Ç–µ—Ä—è–π —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ

- –°–æ–∑–¥–∞—Ç—å —Ç–æ–º:
docker volume create mydata


- –ü–æ–¥–∫–ª—é—á–∏—Ç—å:
docker run -v mydata:/app/data myimage


- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Ç–æ–º–∞:
docker volume ls



---

## üìú –î—Ä–∞–π–≤–µ—Ä—ã –ª–æ–≥–æ–≤

- –ü–æ –¥–µ—Ñ–æ–ª—Ç—É: `json-file`
- –ú–æ–∂–Ω–æ: `syslog`, `journald`, `gelf`, `fluentd`, `awslogs`
- –ú–µ–Ω—è—Ç—å –¥—Ä–∞–π–≤–µ—Ä –ª–æ–≥–æ–≤:
docker run --log-driver=syslog myimage



---

## üì∫ –õ–æ–≥–∏ –∏ live-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
docker logs -f myapp



---

## ü©∫ Healthcheck: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–æ–º–±–∏?

- –í Dockerfile:
HEALTHCHECK CMD curl --fail http://localhost:80 || exit 1


- –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É, —Ç–∞–π–º–∞—É—Ç—ã –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫.

---

## üí™ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

- –ü–∞–º—è—Ç—å:
docker run --memory=512m myimage


- CPU:
docker run --cpus=1 myimage



---

## üõ°Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü–æ –¥–µ—Ñ–æ–ª—Ç—É –≤—Å—ë —Å—Ç–∞—Ä—Ç—É–µ—Ç –æ—Ç root ‚Äî —ç—Ç–æ –Ω–µ –æ–∫.
- –í Dockerfile:
USER appuser


- –ò–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:
docker run --user 1001:1001 myimage



---

## üßä Docker squash: –º–µ–Ω—å—à–µ —Å–ª–æ—ë–≤ ‚Äî –º–µ–Ω—å—à–µ –ø—Ä–æ–±–ª–µ–º

- –°–∂–∞—Ç—å –≤—Å–µ —Å–ª–æ–∏ –≤ –æ–¥–∏–Ω:
docker build --squash -t myimage .



---

## ‚è∏Ô∏è stop vs pause: –≤ —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞?

| –ö–æ–º–∞–Ω–¥–∞         | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                                |
|-----------------|----------------------------------------------------------|
| `docker stop`   | –ü–æ—Å—ã–ª–∞–µ—Ç SIGTERM, –ø–æ—Ç–æ–º SIGKILL ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—ã–∫–ª—é—á–∞–µ—Ç—Å—è  |
| `docker pause`  | –ü—Ä–æ—Å—Ç–æ –∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã, –Ω–æ –Ω–µ –≤—ã–∫–ª—é—á–∞–µ—Ç            |

---

## üíÄ –ö–∞–∫ —É–±–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–∑–Ω—É—Ç—Ä–∏?

- –ü—Ä–æ—Å—Ç–æ —É–±–µ–π –ø—Ä–æ—Ü–µ—Å—Å —Å PID 1:
  
kill 1


- –ò–ª–∏ —Å–Ω–∞—Ä—É–∂–∏:
  
docker kill myapp


---

> **–ò—Ç–æ–≥:**  
> Docker ‚Äî —Ç–≤–æ–π –ª—É—á—à–∏–π –¥—Ä—É–≥, –µ—Å–ª–∏ —Ç—ã –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—à—å –æ–±—Ä–∞–∑—ã –≤ –º—É—Å–æ—Ä–∫—É –∏ –Ω–µ –¥–∞—ë—à—å root-–¥–æ—Å—Ç—É–ø –≤—Å–µ–º—É –ø–æ–¥—Ä—è–¥.  
>  
> **–ü—É—Å—Ç—å —Ç–≤–æ–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –±—É–¥—É—Ç –ª—ë–≥–∫–∏–º–∏, –∂–∏–≤—ã–º–∏ –∏ –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏!**  
