# Логирование в Linux
Логирование — это как бортовой журнал корабля для вашего компьютера. Оно записывает всё, что происходит в системе, и становится незаменимым помощником, когда что-то идёт не так.

## Где хранятся все логи в Linux?

В Linux системные логи обычно хранятся в каталоге `/var/log` — это своего рода "архив" всех системных событий. Вот некоторые из основных файлов логов:

- **/var/log/syslog**: Общие системные логи. Здесь вы найдёте информацию почти обо всём, что происходит в системе — от подключения USB-устройств до запуска программ.
- **/var/log/auth.log**: Логи аутентификации и безопасности. Например, здесь вы увидите записи о всех попытках входа в систему, включая неудачные — очень полезно при поиске взломщиков!
- **/var/log/dmesg**: Логи ядра при загрузке. Если ваше устройство не определяется при загрузке, ответ часто можно найти здесь.
- **/var/log/kern.log**: Логи ядра. Содержит сообщения о работе оборудования, например, почему перестал работать ваш принтер.
- **/var/log/boot.log**: Логи загрузки системы. Если компьютер долго загружается, подсказки можно найти здесь.

## Как работать с journalctl?

`journalctl` — это как "швейцарский нож" для работы с логами в современных Linux-системах с `systemd`. Он позволяет удобно фильтровать и читать логи.

### Основные команды:

- **Просмотр всех логов**: 
  ```bash
  journalctl
  ```
  Выведет всю историю системы — будьте готовы к огромному количеству текста!

- **Просмотр логов текущей загрузки**:
  ```bash
  journalctl -b
  ```
  Полезно, когда вы только что перезагрузились после сбоя и хотите понять, что пошло не так.

- **Фильтрация по времени**:
  ```bash
  journalctl --since "2023-01-01" --until "2023-01-02"
  ```
  Например, если вчера ночью произошёл сбой, вы можете посмотреть только записи за этот период.

- **Фильтрация по сервису**:
  ```bash
  journalctl -u nginx
  ```
  Если веб-сервер nginx перестал работать, эта команда покажет только его сообщения, без лишнего шума.

- **Просмотр последних записей в реальном времени**:
  ```bash
  journalctl -f
  ```
  Это как наблюдение за пульсом системы — вы видите события по мере их возникновения. Очень удобно при отладке.

## Как настроить ротацию логов?

Ротация логов — это как регулярная уборка, чтобы старые записи не занимали всё место на диске. Представьте, что вы никогда не выбрасываете старые газеты — скоро они заполнят весь дом! В Linux для этой "уборки" используется `logrotate`.

### Пример настройки `logrotate`:

1. Создайте файл конфигурации в `/etc/logrotate.d/` для вашего приложения, например, для вашего веб-сервера.
2. Пример конфигурации:

   ```
   /var/log/myapp.log {
       daily                  # Уборка каждый день
       missingok              # Не паникуем, если файл отсутствует
       rotate 7               # Храним недельный архив
       compress               # Сжимаем старые логи для экономии места
       delaycompress          # Сжимаем не сразу, а со следующего дня
       notifempty             # Не обрабатываем пустые файлы
       create 0640 root utmp  # Создаём новый файл с указанными правами
       sharedscripts
       postrotate             # После уборки перезагружаем сервис
           /usr/bin/systemctl reload myapp > /dev/null
       endscript
   }
   ```

Это как настроить робота-уборщика, который будет каждый день аккуратно складывать ваши старые записи в архив, сжимать их и выбрасывать самые старые, чтобы не занимали место.

## Что такое централизованный сбор логов и какие инструменты используются?

Централизованный сбор логов — это как создание единого диспетчерского центра для всех ваших серверов. Представьте, что у вас 100 серверов, и вместо проверки каждого по отдельности, вы видите все события в одном месте. Это как иметь камеры наблюдения со всех объектов на одном экране.

### Основные инструменты:

- **Syslog**: Базовый протокол для передачи логов, как почтовая служба для сообщений между серверами.
- **Rsyslog**: Улучшенная почтовая служба с дополнительными возможностями — сортировкой, фильтрацией и надёжной доставкой.
- **Logstash**: Как умный секретарь, который собирает, обрабатывает и систематизирует все сообщения. Часть популярного комплекса Elastic Stack (ELK).
- **Fluentd**: Гибкий сборщик данных, который можно настроить под любые нужды — как конструктор для сбора логов.
- **Graylog**: Полноценная платформа с красивым веб-интерфейсом, где можно искать, фильтровать и настраивать оповещения. Как продвинутая система видеонаблюдения для ваших серверов.

Например, если у вас есть интернет-магазин на нескольких серверах, централизованный сбор логов позволит увидеть всю картину атаки или сбоя — от веб-сервера до базы данных и системы оплаты. Вместо проверки каждого сервера по отдельности, вы сразу видите полную цепочку событий в одном месте.
