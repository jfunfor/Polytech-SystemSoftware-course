TLS
TLS — это протокол, который обеспечивает безопасность связи по сетям, особенно в интернете. Он помогает защищать конфиденциальные данные от перехвата и подделки во время передачи. Например, когда вы вводите свои кредитные карты на сайте, TLS гарантирует, что эта информация зашифрована и становится недоступной для тех, кто может ее перехватить. TLS шифрует данные, чтобы предотвратить их перехват и несанкционированный доступ, обеспечивая целостность и аутентичность передаваемой информации.

TLS решает несколько важных задач:
- Шифрование: защищает данные от перехвата, шифруя их во время передачи.
- Аутентификация: TLS позволяет клиентам проверять идентичность сервера, к которому они подключаются, часто с помощью цифровых сертификатов.
- Целостность: TLS использует коды аутентификации сообщений (MAC), чтобы проверить, что данные не были изменены во время передачи.

Стоит отметить, что протокол TLS использует два основных вида шифрования:
- Симметричное шифрование: использует один и тот же ключ для шифрования и расшифровки данных, что быстрее, но требует надежного способа передачи ключей.
- Асимметричное шифрование: используется во время рукопожатия для безопасного обмена ключами, позволяя серверу отправлять свой публичный ключ клиенту.

Используемые ключи бывают публичные и приватные.
- Публичный ключ: Этот ключ можно свободно распространять и использовать для шифрования данных. Любой может зашифровать данные с помощью публичного ключа, но только обладатель приватного ключа может их расшифровать.
- Приватный ключ: Этот ключ должен храниться в секрете. Он используется для расшифровки данных, зашифрованных с помощью соответствующего публичного ключа.
Генерация ключей может выполняться с помощью различных инструментов и библиотек, таких как OpenSSL, которые поддерживают несколько алгоритмов, включая RSA, ECDSA и другие.
Генерация ключей (пример с RSA):
- Генерация приватного ключа
openssl genpkey -algorithm RSA -out private.key -pkeyopt rsa_keygen_bits:2048

- Получение публичного ключа
openssl rsa -pubout -in private.key -out public.key

Версии TLS
- TLS 1.0: Введен в 1999 году как более безопасная альтернатива SSL 3.0, но сейчас считается устаревшим.
- TLS 1.1: Введен в 2006 году, добавляет защиту от некоторых типов атак, таких как атаки на блочное шифрование (CBC).
- TLS 1.2: Введен в 2008 году, широко используется, поддерживает современные криптографические алгоритмы и все еще актуален.
- TLS 1.3: Введен в 2018 году, оптимизирован для повышения производительности и безопасности, сокращает количество раундов, необходимых для установления защищенного соединения.

TLS является преемником протокола SSL (Secure Sockets Layer). Хотя TLS и SSL часто используются как синонимы, важно отметить, что SSL в настоящее время считается устаревшим и небезопасным. 
Основные отличия заключаются в следующем:
- Безопасность: TLS предлагает более высокие уровни безопасности по сравнению с SSL, благодаря использованию более современных алгоритмов шифрования и улучшенным механизмам аутентификации.
- Протоколы: TLS включает в себя улучшения, которые устраняют уязвимости, обнаруженные в предыдущих версиях SSL.
- Нумерация: TLS имеет разные версии (TLS 1.0, 1.1, 1.2, 1.3), в то время как SSL имел только три версии (SSL 1.0, 2.0, 3.0).

Чтобы установить доверие между клиентом и сервером при защищенном соединении используется сертификат. 
Цифровой сертификат — это своего рода «паспорт» сервера (или другого субъекта), который подтверждает его подлинность.
Цифровая подпись сертификата — это криптографическая проверка, сделанная удостоверяющим центром (CA). Она гарантирует, что:
- Сертификат действительно выдан этим центром;
- Его содержимое не изменилось с момента выдачи.
Удостоверяющие центры (CA) используют TLS для генерации и выдачи сертификатов. Процесс включает:
- Создание CSR (Certificate Signing Request): Пользователь создает запрос на подпись сертификата, который включает публичный ключ и идентифицирующую информацию. Этот CSR отправляется CA для проверки.
- Проверка CA: CA проверяет информацию в CSR, что может включать проверку права собственности на домен или организационной идентичности.
- Подпись сертификата: после проверки CA подписывает CSR, создавая цифровой сертификат, который связывает публичный ключ с идентичностью пользователя.
- Цепочка доверия: CA поддерживает иерархию доверия; корневые сертификаты находятся на вершине, а промежуточные сертификаты помогают установить доверие к сертификатам конечных пользователей.
Процесс получения сертификата:
- Генерация пары ключей: openssl genpkey -algorithm RSA -out private.key
- Создание запроса на сертификат (CSR): openssl req -new -key private.key -out request.csr
- Отправка CSR в CA.
- CA подписывает сертификат, возвращает .crt файл.
- Сертификат устанавливается на сервер.

Пример самоподписанного сертификата: openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
-keyout my.key -out my.crt

Полный процесс работы TLS (обмен ключами) в HTTPS и рукопожатие TLS
- ClientHello: Клиент инициирует рукопожатие, отправляя сообщение, в котором указаны поддерживаемые версии TLS, шифры и случайные данные.
- ServerHello: Сервер отвечает, выбирая версию протокола и шифр, а также отправляет свои случайные данные.
- Сертификат: Сервер отправляет свой цифровой сертификат, который содержит его публичный ключ и подписан доверенным удостоверяющим центром (CA).
- Обмен ключами: Клиент генерирует предварительный секрет, шифрует его публичным ключом сервера и отправляет серверу.
- Сессионные ключи: как клиент, так и сервер используют предварительный секрет и случайные числа, обмененные ранее, для получения сессионных ключей.
- Сообщения о завершении: Обе стороны отправляют сообщение о завершении, и защищенная связь может начаться.
